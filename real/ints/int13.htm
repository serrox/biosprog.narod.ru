<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Низкоуровневое програмирование</title>
	<meta name="keywords" content="программирование, BIOS, INT, INT 13, реальный режим, ассемблер, 16bit, дисковый сервис, Enhanced Disk Drive, Enhanced Disk Drive Service, EDD, Bootable CD, Загружаемый CD" />
	<meta name="description" content="Низкоуровневое программирование: Прерывания БИОС: INT 13: Дисковый ввод-вывод, Enhanced Disk Drive Service, Bootable CD" />
    <style type="text/css">
        .auto-style1 {
            height: 26px;
        }
    </style>
</head>
<body>
<!-- Yandex.Metrika counter -->
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>
<script type="text/javascript">
try { var yaCounter2269369 = new Ya.Metrika({id:2269369,
          webvisor:true,
          trackLinks:true,
          accurateTrackBounce:true});
} catch(e) { }
</script>
<noscript><div><img src="//mc.yandex.ru/watch/2269369" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
	<a href=../../index.htm>Главная</a> - <a href=../index.htm> Реальный режим </a> - <a href=int.htm>Прерывания Bios</a> - <b>INT 13h: Дисковый ввод-вывод .</b><br />
	<h2>INT 13h: Дисковый ввод-вывод .</h2>
	<div style="font-size: 13pt">Данное прерывание реализует несколько наборов API для работы с дисками</div><br/>
	<h3>Оглавление</h3>
	<ul>
		<li><a href="#old">"Класический" API</a></li>
		<li><a href="#EDD">"Расширенный" API (EDD)</a></li>
		<li><a href="#CD">Сервис загружаемых CD</a></li>
	</ul>
	<a name=old><h3>"Класический" API</h3></a>
	<div style="font-size: 13pt">Класический API использует адресацию в формате CHS (Цилиндр-Головка-Сектор), отводя под адрес 24 бита, и при этом имеет "разрывы" в нумерации. Таким образом возможно адресовать до 7,8 Гб информации, и поэтому данный API является устаревшим и миеет смысл если вы работаете с дискетами или на старом компьютере, не поддерживающем новые API.<br/>
	Хотя максимальный адресуемый размер зависит от размера сектора, обычно приводится предел в 7,8 или 8 Гб, т.к. диcки с размером сектора, отличным от 512 Кб являются редкостью, а современные диски в силу определённых причин "скрывают" реальную геометрию за некими усреднёнными параметрами.<br/></div>
<table border=1 width=100%><tr><td valign=top>AH</td><td> функция </td></tr><tr><td valign=top>
0</td><td>Сброс устройства.<br /><br/>
		<b>Вход:</b><br/>
		DL - номер устройства<br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br /><br/>
		<b>Примечание:</b><br/>
		Вызывает рекалибрацию контроллера, голоыки диска устанавливаются на нулевой трек.<br/>
		НА некоторых системах, в случае, если на одной линии расположено два диска (конфигурация Master/Slave), запрос на реколибрацию выполняется обоими дисками.</td></tr><tr><td valign=top>
1</td><td>Дать статус ошибки последней операции.<br /><br/>
		<b>Вход:</b><br/>
		DL = диск.<br /><br/>
		<b>Выход:</b><br/>
		AH содержит <a href=#code>код ошибки диска</a><br/><br/>
		<b>Примечание:</b><br/>
		Некоторые БИОСы учитывают ошибки не всех операций </td></tr><tr><td valign=top>
<a name=2>2</a></td><td>Читать секторы<br /><br/>
		<b>Вход:</b><br/>
		DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
        DH = номер головки чтения/записи<br />
        CH = биты 0-7 номера дорожки (цилиндра)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - номер сектора (Считая с 1)<br />
		&nbsp;&nbsp;биты 6-7 - биты 8-9 номера дорожки<br />
        AL = число секторов<br />
        ES:BX => адрес буфера вызывающей программы<br /><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
        ES:BX буфер содержит данные, прочитанные с диска.<br />
		AL - количество считанных секторов (кроме ошибки 11h)<br/><br/>
		<b>Примечание:</b><br/>
		Старые БИОСы могут не поддерживать переход с одной дорожки на другую в процессе чтения, так что будте осторожны!<br/>
		Документация на PhoenixBios (rev 6) утверждает, что максимальное значение, передаваемое в AL - 80h</td></tr><tr><td valign=top>
3</td><td>Писать секторы<br /><br/>
		<b>Вход:</b><br/>
		DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
        DH = номер головки чтения/записи<br />
        CH = биты 0-7 номера дорожки (цилиндра)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - номер сектора (Считая с 1)<br />
		&nbsp;&nbsp;биты 6-7 - биты 8-9 номера дорожки<br />
        AL = число секторов (в сумме не больше чем один цилиндр)<br />
        ES:BX => адрес буфера вызывающей программы<br /><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AL - количество записанных секторов<br/><br/>
		<b>Примечание:</b><br/>
		Старые БИОСы могут не поддерживать переход с одной дорожки на другую в процессе записи, так что будте осторожны!<br/>
		Документация на PhoenixBios (rev 6) утверждает, что максимальное значение, передаваемое в AL - 80h</td></tr><tr><td valign=top>
4</td><td>Проверить секторы. проверяет CRC для указанных секторов на ошибки.<br /><br/>
		<b>Вход:</b><br/>
		DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
        DH = номер головки чтения/записи<br />
        CH = биты 0-7 номера дорожки (цилиндра)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - номер сектора (Считая с 1)<br />
		&nbsp;&nbsp;биты 6-7 - биты 8-9 номера дорожки<br />
        AL = число секторов (в сумме не больше чем один цилиндр)<br />
        Для биосов старше 15 ноября 1985-го года: ES:BX => адрес буфера вызывающей программы<br /><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AL - количество проверенных секторов<br/><br/>
		<b>Примечание:</b><br/>
		Старые БИОСы могут не поддерживать переход с одной дорожки на другую в процессе записи, так что будте осторожны!<br/>
		Документация на PhoenixBios (rev 6) утверждает, что максимальное значение, передаваемое в AL - 80h, а для дисков с ECC - 79h</td></tr><tr><td valign=top>
5</td><td>Форматировать дорожку.<br /><br/>
		<b>Вход:</b><br/>
		DL,DH,CH = диск,головка,дорожка (см. функцию <a href=int13.htm#2>02H</a>)<br />
        ES:BX => дескрипторы секторов (формат дескрипторов см. ниже)<br/>
        &nbsp;&nbsp;дискета: 4-байтовый 'CHNS' (C - цилиндр,H - головка,N - сектор, S - размер) для каждого сектора на дорожке (т.е. 36 байт для 9-секторных дорожек); номера секторов должны быть упорядочены. 'S' - код размера сектора:  0=128; 1=256; 2=512; 3=1024<br />
        &nbsp;&nbsp;<font color=red>для AT</font> Тв. диск: 2-байтовый 'FN' (F - флаг,N - сектора) для каждого сектора на дорожке. последовательность полей 'N' определяет "коэффициент прослаивания" ("interleave factor").<br />
        &nbsp;&nbsp;<font color=red>для XT</font> Тв. диск: ES:BX не используется. Вместо этого AL содержит значение "прослаивания" между 1 и 16 (10h).<br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AL - количество отформатированных секторов<br/><br/>
		<b>Примечание:</b><br/>
		Данные на дорожке разрушаются.<br/>
        Тв. диск: 'F'-поля установливаются в 80h для плохих секторов<br />
		Крайне не реккомендуется применять эту функцию к современным жёстким дискам</td></tr><tr><td valign=top>
6</td><td>Форматировать дорожку и проверить на битые сектора.(HDD)<br /><br/>
		<b>Вход:</b><br/>
		AL - "коэффициент прослаивания" ("interleave factor")<br/>
		DL,DH,CH = диск,головка,дорожка (см. функцию <a href=int13.htm#2>02H</a>)<br />
		CL = 0<br/><br/>
		<b>Выход:</b><br/>
		AH - <a href=#code>код ошибки</a><br /><br />
		<b>Примечание:</b><br/>
		Данные на дорожке разрушаются.<br/>
		Эта функция поддерживается не всеми дисками<br/>
		Крайне не реккомендуется применять эту функцию к современным жёстким диска<br/>
        'F'-поля установливаются в 80h для плохих секторов<br />
		Некоторые БИОСы размещают в битах 6 и 7 регистра DH биты 10 и 11 номера дорожки</td></tr><tr><td valign=top>
7</td><td>Форматировать диск начиная с заданной дорожки<br /><br/>
		<b>Вход:</b><br/>
		AL - "коэффициент прослаивания" ("interleave factor")<br/>
		DL,DH,CH = диск,головка,дорожка (см. функцию <a href=int13.htm#2>02H</a>)<br />
		CL = 0<br/><br/>
		<b>Выход:</b><br/>
		AH - <a href=#code>код ошибки</a><br /><br />
		<b>Примечание:</b><br/>
		Данные на дорожке разрушаются.<br/>
		Эта функция поддерживается не всеми дисками<br/>
		Крайне не реккомендуется применять эту функцию к современным жёстким диска<br/>
        'F'-поля установливаются в 80h для плохих секторов<br />
		Некоторые БИОСы размещают в битах 6 и 7 регистра DH биты 10 и 11 номера дорожки</td></tr><tr><td valign=top>
8</td><td>Параметры диска<br /><br/>
		<b>Вход:</b><br/>
		DL = диск<br /><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		если AL, CX или DX ==0, то произошла ошибка и <a href=#code>код ошибки диска</a> в AH.<br />
		DL = число тв. дисков на первом контроллере<br />
        DH = максимальный номер головки<br />
        CH = максимальный номер цилиндра (младшие 8 бит)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - максимальный номер сектора (и старшие биты максимум номера цилиндра)<br />
		&nbsp;&nbsp;биты 6-7  - биты 8-9 максимаьного номера цилиндра<br/>
		Для дискет: ES:DI - указатель на таблицу параметров дискеты<br/>
		Для дискет: BL - Тип дисковода:<br/>
		&nbsp;&nbsp; 0 - ошибка при определении типа дисковода<br/>
		&nbsp;&nbsp; 1 - 360 кб, 5 дюймов, 40 дорожек<br/>
		&nbsp;&nbsp; 2 - 1.2 мб, 5 дюймов, 80 дорожек<br/>
		&nbsp;&nbsp; 3 - 720 кб, 3 дюйма, 80 дорожек<br/>
		&nbsp;&nbsp; 4 - 1.44 мб, 3 дюйма, 80 дорожек<br/>
		&nbsp;&nbsp; 5 - не определено, однако на некоторых компьютерах означает 2.88 мб, 3 дюйма<br/>
		&nbsp;&nbsp; 6 - 2.88 мб, 3 дюйма<br/>
		&nbsp;&nbsp; 10 - ATAPI-совместимое устройство со съёмным носителем<br/><br/>
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
9</td><td>Инициализировать параметры диска<br /><br/>
		<b>Вход:</b><br/>
		DL - номер диска<br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br /><br/>
		<b>Примечание:</b><br/>
		Векторы для INT 41h и INT 46h адресуют Табл. параметров тв. диска соответственно для устройств 0 и 1.<br />
		В XT совместимом компьютере обе таблицы указываются через вектор INT 40h.<br />
		<font color=red><b>Только AT совместимые компьютеры</b></font><br />
		Сообщает BIOS о любом динамическом изменении таблиц параметров устройства.</td></tr><tr><td valign=top>
0Ah</td><td>Длинное чтение<br /><br />
		<b>Вход:</b><br/>
		DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
        DH = номер головки чтения/записи<br />
        CH = биты 0-7 номера дорожки (цилиндра)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - номер сектора (Считая с 1)<br />
		&nbsp;&nbsp;биты 6-7 - биты 8-9 номера дорожки<br />
        AL = число секторов<br />
        ES:BX => адрес буфера вызывающей программы<br/><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		ES:BX => считанные данные<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры<br/>
		Документация на PhoenixBios (rev 6) утверждает, что максимальное значение, передаваемое в AL - 79h</b></font><br /></td></tr><tr><td valign=top>
0Bh</td><td>Длинная запись<br /><br />
		<b>Вход:</b><br/>
		DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
        DH = номер головки чтения/записи<br />
        CH = биты 0-7 номера дорожки (цилиндра)<br />
        CL =<br />
		&nbsp;&nbsp;биты 0-5 - номер сектора (Считая с 1)<br />
		&nbsp;&nbsp;биты 6-7 - биты 8-9 номера дорожки<br />
        AL = число секторов<br />
        ES:BX => адрес буфера вызывающей программы<br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br /><br />
		<b>Примечание:</b><br/>
		512 байт + 4-байтоый ECC (код коррекции ошибок).<br />
		<font color=red><b>Только AT и XT совместимые компьютеры<br/>
		Документация на PhoenixBios (rev 6) утверждает, что максимальное значение, передаваемое в AL - 79h</b></font><br /></td></tr><tr><td valign=top>
0Ch</td><td>Искать цилиндр<br /><br />
		<b>Вход:</b><br/>
		DL - номер диска<br />
		DH - Номер Головки<br />
		CH - Номер дорожки<br />
		CL - старшие биты номера дорожки<br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
		Перемещает головку к нужной дорожке</td></tr><tr><td valign=top>
0Dh</td><td>Сброс устройства<br/><br />
		<b>Вход:</b><br/>
		DL - диск<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
0Eh</td><td>Читать буфер секторов<br /><br />
		<b>Вход:</b><br/>
		как для <a href=int13.htm#2>функции 02H</a><br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		По адресу ES:BX содержание буфера<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
0Fh</td><td>Писать буфер секторов<br /><br />
		<b>Вход:</b><br/>
		как для <a href=int13.htm#2>функции 02h</a><br/><br/>
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		По адресу ES:BX содержание буфера<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
10h</td><td>проверить готовность устройства<br/><br />
		<b>Вход:</b><br/>
		DL = диск<br/><br/>
		<b>Выход:</b><br/>
		<a href=#code>код ошибки диска</a> (статус) в AH.(обычно при запуске системы номер диска, с которого проведён запуск  передаётся в DL, но НЕ при запуске программы в DOS)<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
11h</td><td> Рекалибровать устройство<br/><br />
		<b>Вход:</b><br/>
		DL = диск(обычно при запуске системы номер диска, с которого проведён запуск  передаётся в DL, но НЕ при запуске программы в DOS)<br/><br/>
		<b>Выход:</b><br/>
		<a href=#code>код ошибки диска</a> (статус) в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
12h</td><td> Диагностика RAM контроллера<br /><br />
		<b>Вход:</b><br/>
		DL = диск<br/><br/>
		<b>Выход:</b><br/>
		<a href=#code>код ошибки диска</a> (статус) в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
13h</td><td> Диагностика устройства<br /><br />
		<b>Вход:</b><br/>
		DL = диск<br/><br/>
		<b>Выход:</b><br/>
		<a href=#code>код ошибки диска</a> (статус) в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
14h</td><td> Внутренняя диагностика контроллера<br/><br />
		<b>Вход:</b><br/>
		DL = диск<br/><br/>
		<b>Выход:</b><br/>
		<a href=#code>код ошибки диска</a> (статус) в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и XT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
15h</td><td>Читать тип диска (недоступна в XT BIOS)<br /><br />
		<b>Вход:</b><br/>
		DL = диск<br /><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AH = код устройства:<br />
		&nbsp;&nbsp;== 0 , AL!=3 устройство DL отсутствует<br />
		&nbsp;&nbsp;== 0 , AL==3 Жёсткий диск<br />
		&nbsp;&nbsp;== 1 дискета; статус замены диска неподдерживается<br />
		&nbsp;&nbsp;== 2 дискета; статус замены диска доступен (большинство случаев)<br />
		&nbsp;&nbsp;== 3 Жёсткий диск<br/><br />
		<b>Примечание:</b><br/>
		Для жёстких дисков по адресу CX:DX передаётся количество секторов<br />
		<font color=red><b>Только AT совместимые компьютеры</b></font></td></tr><tr><td valign=top>
16h</td><td>Читать статус замены диска<br /><br />
		<b>Вход:</b><br/>
		DL = диск<br /><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AH = код статуса:<br />
		&nbsp;&nbsp;0 = замена диска непроизводится<br />
		&nbsp;&nbsp;1 = неверный номер диска;<br />
		&nbsp;&nbsp;6 = производится замена диска (открыта дисковая дверь), либо статус замены диска неподдерживается<br />
		&nbsp;&nbsp;80 = ошибка таймаута<br/><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font><br/>
		Не реккомендуется использовать на очень старых биосах, так как многие из них имеют ошибки в реализации из-за которых могут "испортится" различные данные</td></tr><tr><td valign=top>
17h</td><td>Установить тип дискеты (используется перед операцией форматирования)<br /><br />
		<b>Вход:</b><br/>
		DL = номер устройства диска (0 или 1)<br />
		AL = тип носителя диска:<br />
		&nbsp;&nbsp;0 = не используется<br />
		&nbsp;&nbsp;1 = 360K дискета в 360K устройстве<br />
		&nbsp;&nbsp;2 = 360K дискета в 1.2M устройстве<br />
		&nbsp;&nbsp;3 = 1.2M дискета в 1.2M устройстве<br />
		&nbsp;&nbsp;4 = 720K дискета в 720K или (поддерживается не всеми биосами) 1.44M устройстве<br/><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT совместимые компьютеры</b></font><br/>
		Документация на PhoenixBios (rev 6) явно оговаривает что случай с 1.44М дискетами не поддерживается, поэтому я реккомендую использовать функцию <a href=18>18h</a></td></tr><tr><td valign=top>
<a name=18>18h</a></td><td>Установить тип диска (используется перед операцией форматирования)<br /><br />
		<b>Вход:</b><br/>
		DL = номер устройства диска <br />
		CH = Максимальный номер цилиндра<br />
		CL :<br />
		&nbsp;&nbsp;биты 0-5 кол-во секторов на дорожке<br />
		&nbsp;&nbsp;биты 6,7 старшие биты номера цилиндра<br /><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		ES:DI - таблица параметров дискеты<br /><br />
		<b>Примечание:</b><br/>
		<font color=red><b>Только AT и/или XT совместимые компьютеры</b></font>
		Не многие БИОСы устанавливают основную таблицу параметров диска в соответствии со сформированной этой функцией, по этому рекомендуется перед проведением форматирования произвести замену адреса <a href=int1e.htm>вектора прерывание 1Eh</a></td></tr><tr><td valign=top>
20h</td><td>Получить тип дискеты<br /><br />
		<b>Вход:</b><br/>
		DL = номер устройства диска (0 или 1)<br /><br />
		<b>Выход:</b><br/>
		Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
		AL - тип:<br />
		&nbsp;&nbsp;00 - 720 кб<br />
		&nbsp;&nbsp;01 - 1.44 мб<br />
		&nbsp;&nbsp;02 - 2.88 мб<br />
		&nbsp;&nbsp;03 - 1 мб (неформатированная 720 кб)<br />
		&nbsp;&nbsp;04 - 2 мб (неформатированная 1.44 мб)<br />
		&nbsp;&nbsp;06 - 4 мб (неформатированная 2.88 мб)<br />
		&nbsp;&nbsp;0Ch - 360 кб<br />
		&nbsp;&nbsp;0Dh - 1,2 мб<br />
		&nbsp;&nbsp;0Eh и 0Fh - дискета с размером сектора 1024 кб<br />
		&nbsp;&nbsp;10h - устройство ATAPI<br /><br />
		<b>Примечание:</b><br/>
		Некоторые старые БИОСы неподдерживают эту функцию<br />
		БИОСы Compaq изготовленные до 1993 года всегда возвращают 0 в AL
</td></tr>
</table>
<br />
<a name=code>Коды ошибок классического API</a><br />
<table border=1 width=100%>
<tr><td>Код</td><td>Значение</td></tr><tr><td valign=top>
00</td><td>Нет ошибки</td></tr><tr><td valign=top>
01</td><td>Неизвестная/неверная комманда</td></tr><tr><td valign=top>
02</td><td>Не найдена адресная метка</td></tr><tr><td valign=top>
03</td><td>Диск защищён от записи</td></tr><tr><td valign=top>
04</td><td>Не найден сектор</td></tr><tr><td valign=top>
05</td><td>Ошибка при сбросе HDD</td></tr><tr><td valign=top>
06</td><td>Произошла замена дискеты</td></tr><tr><td valign=top>
07</td><td>Ошибка инициализации</td></tr><tr><td valign=top>
08</td><td>Ошибка DMA</td></tr><tr><td valign=top>
09</td><td>Выход за приделы 64КБ при работе с DMA</td></tr><tr><td valign=top>
0Ah</td><td>Плохой сектор</td></tr><tr><td valign=top>
0Bh</td><td>Плохая дорожка</td></tr><tr><td valign=top>
0Ch</td><td>Неправильный номер дорожки (В некоторых биосах - не правильный номер устройства)</td></tr><tr><td valign=top>
0Dh</td><td>Неправильный номер сектора</td></tr><tr><td valign=top>
0Eh</td><td>Обнаружена адресная метка управляющих данных</td></tr><tr><td valign=top>
0Fh</td><td>Ошибка DMA</td></tr><tr><td valign=top>
10h</td><td>Ошибка данных (неверная контрольная сумма)</td></tr><tr><td valign=top>
11h</td><td>Была произведена коррекция данных для устраниния ошибки</td></tr><tr><td valign=top>
20h</td><td>Сбой контроллера</td></tr><tr><td valign=top>
30h</td><td>Неподдерживаемый формат дискеты</td></tr><tr><td valign=top>
31h</td><td>Дискета извлечена</td></tr><tr><td valign=top>
32h</td><td>Неподдерживаемый тип дискеты</td></tr><tr><td valign=top>
40h</td><td>Сбой при поиске дорожки</td></tr><tr><td valign=top>
80h</td><td>Ошибка таймаута</td></tr><tr><td valign=top>
AAh</td><td>Диск не готов</td></tr><tr><td valign=top>
BBh</td><td>Неисовместимый контроллер или неизвестная ошибка</td></tr><tr><td valign=top>
CCh</td><td>Сбой при записи</td></tr><tr><td valign=top>
E0h</td><td>Неопознанная ошибка контроллера</td></tr><tr><td valign=top>
FFh</td><td>Ошибка при чтении</td></tr></table>
<br />
<br />
	<a name="EDD"><h3>"Расширенный" API</h3></a>
	<div style="font-size: 13pt">Этот набор API реализует стандарт Enhanced Disk Drive (EDD), а так же некоторые дополнительные возможности<br />
	EDD используют для адресации одно значение размером в 64 бита, что позволяет использовать диски с размером примерно до 8-ми зеттабайт. На деле стоит понимать, что количество реально используемых бит ограничено возможностями аппаратуры, к примеру ранние реализации  этого стандарта позволяли использовать только 28 бит (128 гбайт), а в настоящее время существует ограничение в 48 бит(128 петабайт).<br/>
	EDD предназначен для работы с устройствами в режиме адресации LBA, однако зачастую прекрасно работает и со старыми устройствами, не поддерживающими этот тип адресации.<br /></div>
<table border=1 width=100%><tr><td valign=top>AH</td><td> функция </td></tr><tr><td valign=top>
<a name="41">41h</a></td><td>Проверка наличия расширения.<br /><br />
	<b>Вход:</b><br />
	BX = 55AAh<br />
	DL - номер диска(80h ... 0FFh)<br /><br />
	<b>Выход:</b><br />
	Флаг переноса установлен - расширение не поддерживается<br />
	Флаг переноса сброшен - расширение поддерживается:<br />
	BX = 55AAh<br />
	AL - изменено<br />
	AH - номер версии (01 - первая; 20h - EDD версии 1.0, версия реализации функций 2; 21h - EDD версии 1.1, версия реализации функций 2; 30h - третья версия)<br />
	CX - поддерживаемые возможности:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; бит 0  = 1 : поддержка расширенного доступа к жёсткому диску диску (функции 42h-44h, 47h, 48h)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; бит 1  = 1 : поддержка расширенного управления дисками со съёмным носителем (функции 45h, 46h, 48h, 49h)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; бит 2  = 1 : поддержка расширенного EDD (функции 48h,4Eh)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; биты 3-15 - резерв<br /><br />
	<b>Примечание:</b><br />
	В некоторых реализациях регистр DH может быть изменён<br />
	В некоторых источниках утверждается, что третий бит регистра CX обозначает поддержку 64-х битного расширения для адреса буфера, однако найти подтверждение этому в официальной документации не удалось.</td></tr><tr><td valign=top>
<a name="42">42h</a></td><td>Расширенное чтение.<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	DS:SI - адрес пакета адресации<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Пакет адресации представляет из себя следующую структуру:<br />
	<table border=1 width=100%><tr><td>Смещение</td><td>Размер</td><td>Смысл</td></tr><tr><td valign=top>
		0</td><td> BYTE</td><td>Размер пакета. Не меньше 10h, кроме того БИОС "окургляет" это значение до бижайшего меньшего известного ему значения, таким образом не рекомендуется передавать значения, отличные от 10h или 18h</td></tr><tr><td valign=top>
		1</td><td> BYTE</td><td>Резерв</td></tr><tr><td valign=top>
		2</td><td> BYTE</td><td>Чило передаваемых секторов(0 - 7Fh).</td></tr><tr><td valign=top>
		3</td><td> BYTE</td><td>Резерв</td></tr><tr><td valign=top>
		4</td><td> DWORD</td><td>Адрес буфера (сегмент:смещение). Значение FFFFh:FFFFh означает, что используется поле расширенного адреса буфера</td></tr><tr><td valign=top>
		8</td><td> QWORD</td><td>Номер начального блока</td></tr><tr><td valign=top>
		10h</td><td> QWORD</td><td>Расширенный адрес буфера. Используется, если адрес буфера установлен в FFFFh:FFFFh.</td></tr>
	</table>
	В некоторых источниках в пакете адресации указываются ещё несколько полей, однако найти подтверждение этому в официальной документации мне не удалось.<br />
	Если произошла ошибка в процессе чтения, то в поле число блоков записывается число считанных блоков</td></tr><tr><td valign=top>
43h</td><td>Расширенная запись.<br /><br />
	<b>Вход:</b><br />
	AL - 0 или 1 - запись без проверки данных, 2 - запись с проверкой данных<br />
	DL - номер диска(80h ... 0FFh)<br />
	DS:SI - адрес пакета адресации<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Пакет адресации описан в <a href="#42">функции 42h</a>.
	Устройство может не поддерживать запись данных с проверкой
	Если произошла ошибка в процессе записи, то в поле число блоков записывается число записанных блоков</td></tr><tr><td valign=top>
44h</td><td>Проверить секторы<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	DS:SI - адрес пакета адресации<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Пакет адресации описан в <a href="#42">функции 42h</a>.
	Если произошла ошибка в процессе проверки, то в поле число блоков записывается число проверенных блоков</td></tr><tr><td valign=top>
45h</td><td>Заблокировать/разблокировать устройство<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	AL :<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0 - заблокировать<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 1 - разблокировать<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 2 - узнать статус<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	AL - состояние диска
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Эта функция подразумевает, что носитель информации нельзя извлечь, пока устройство заблокированно.<br />
	Эта функция поддерживает до 255 блокировок на устройство. Для каждой блокировки необходима своя команда разблокировки.<br />
	Если подать команду разблокировки на разблокированный диск, функция вернёт ошибку.<br />
	Некоторые диски с несъёмными носителями информации допускают использование команды блокировки. Точный смысл этой команды в таком случае зависит от производителя жёсткого диска.</td></tr><tr><td valign=top>
<a name="46">46h</a></td><td>Извлечь носитель информации из устройства<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	AL = 00 (резерв)<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Если диск заблокирован, то функция вернёт ошибку.<br />
	Если диск имеет несъёмный носитель, то функция вернёт ошибку.<br />
	При попытке извлечь носитель из пустого дисковода функция вернёт ошибку.<br/>
	Эта функция использует <a href="int15.htm#52">функцию 52h прерывания 15h</a></td></tr><tr><td valign=top>
47h</td><td>Расширенный поиск<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	DS:SI - адрес пакета адресации<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br /><br />
	<b>Примечание:</b><br />
	Это функция позволяет сообщить устройству, какой следующий блок понадобится системе</td></tr><tr><td valign=top>
48h</td><td>Получить параметры диска<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	DS:SI - адрес буфера для сохранения параметров(не менее 26 байт, рекомендуется 66)<br /><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка<br />
	По адресу DS:SI расположена таблица с параметрами диска:<br />
	<table width=100% border=1><tr><td>
		Смещение</td><td>Размер</td><td>Смысл</td></tr><tr><td valign=top>
		00</td><td> WORD</td><td>Размер буфера в байтах. Должен быть установлен до вызова функции.</td></tr><tr><td valign=top>
		02</td><td> WORD</td><td> бит 0 : "Прозрачное" управление сообщениями о нарушении границ при сипользовании DMA<br />
								  бит 1 : Информаци о геометрии диска (значения по смещениям 4, 8 и 12) достоверна<br />
								  бит 2 : Диск является устройством со сменным носителем. Если этот бит сброщен, то значение по смещению 4 не достовено, вне зависимости от значения бита 1<br />
								  бит 3 : Диск поддерживает режим записи с верификацией<br />
								  бит 4 : Устройство подаёт сигнал при смене носителя (имеет смысл, если бит 2 установлен)<br />
								  бит 5 : Устройство может быть заблокированно<br />
								  бит 6 : Съёмный носитель в дисководе отсутствует, по смещениям 4, 8 и 12 записаны максимально возможные для этого устройства значения<br />
								  бит 7 : БИОС использует функцию 50h прерывания 13h для доступа к устройству<br />
								  биты 8-15 : резерв</td></tr><tr><td valign=top>
		04</td><td> DWORD</td><td>Количество цилиндров</td></tr><tr><td valign=top>
		08</td><td> DWORD</td><td>Количество головок</td></tr><tr><td valign=top>
		12</td><td> DWORD</td><td>Количество секторов на треке</td></tr><tr><td valign=top>
		16</td><td> QWORD</td><td>Количество секторов на диске</td></tr><tr><td valign=top>
		24</td><td> WORD</td><td>Количество байт в секторе</td></tr><tr><td valign=top>
		26</td><td> DWORD</td><td>Указатель на таблицу конфигурации EDD (сегмент:смещение). Значение FFFFh:FFFFh означает, что таблица не доступна.</td></tr><tr><td valign=top>
		30</td><td> WORD</td><td>== 0BEDD - признак того, что дальнейшие поля присутствуют</td></tr><tr><td valign=top>
		32</td><td> BYTE</td><td>Количество байт в таблице начиная со смещения 30h</td></tr><tr><td valign=top>
		33</td><td> BYTE</td><td>Резерв</td></tr><tr><td valign=top>
		34</td><td> WORD</td><td>Резерв</td></tr><tr><td valign=top>
		36</td><td> 4*BYTE</td><td>Тип шины:<br />
								  "PCI " (50h, 43h, 49h, 20h) - шина PCI или совместимая<br />
								  "PCIX" (50h, 43h, 49h, 58h) - шина PCI-X<br />
								  "IBND" (49h, 42h, 4Eh, 44h) - шина InfiniBand<br />
								  "XPRS" (58h, 50h, 52h, 53h) - шина PCI-Express<br />
								  "HTPT" (48h, 54h, 50h, 54h) - шина HyperTransport<br />
								  "ISA " (49h, 53h, 41h, 20h) - шина ISA</td></tr><tr><td valign=top>
		40</td><td> 8*BYTE</td><td> Тип интерфейса<br />
								  "ATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;(41h, 54h, 41h, 20h, 20h, 20h, 20h, 20h) - Устройство ATA/ATAPI с набором команд ATA<br />
								  "ATAPI&nbsp;&nbsp;&nbsp;" (41h, 54h, 41h, 50h, 49h, 20h, 20h, 20h) - Устройство ATA/ATAPI с набором команд ATAPI<br />
								  "SCSI&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;&nbsp;(53h, 43h, 53h, 49h, 20h, 20h, 20h, 20h) - SCSI - совместимое устройство<br />
								  "USB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;&nbsp;(55h, 53h, 42h, 20h, 20h, 20h, 20h, 20h) - Устройство с интерфейсом USB<br />
								  "1394&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;&nbsp;(31h, 33h, 39h, 34h, 20h, 20h, 20h, 20h) - Устройство с интерфейсом IEEE 1394 (FireWire)<br />
								  "FIBRE&nbsp;&nbsp;&nbsp;" &nbsp;(46h, 49h, 42h, 52h, 45h, 20h, 20h, 20h) - Устройство с интерфейсом Fibre Chanel<br />
								  "I2O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;&nbsp;&nbsp;(49h, 32h, 4Fh, 20h, 20h, 20h, 20h, 20h) - Устройство подключено к шине I<sub>2</sub>O<br />
								  "RAID&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;(52h, 41h, 49h, 44h, 20h, 20h, 20h, 20h) - Устройство является частью RAID-массива<br />
								  "SATA&nbsp;&nbsp;&nbsp;&nbsp;" (53h, 41h, 54h, 41h, 20h, 20h, 20h, 20h) - Устройство с интерфейсом SATA<br />
								  "SAS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" &nbsp;&nbsp;(53h, 41h, 53h, 20h, 20h, 20h, 20h, 20h) - Устройство с интерфейсом SAS</td></tr><tr><td valign=top>
		48</td><td> QWORD</td><td> Путь на шине</td></tr><tr><td valign=top>
		56</td><td> QWORD</td><td> Путь к устройству</td></tr><tr><td valign=top>
		64</td><td> BYTE</td><td> Резерв</td></tr><tr><td valign=top>
		65</td><td> BYTE</td><td> Контрольная сумма</td></tr></table><br /><br />
	<b>Примечание:</b><br />
	Значения в таблице конфигурации EDD и её адрес могут менятся при вызове функций EDD<br />
	Предварительная редакция 4-ой версии стандарта EDD утверждает, что поле "путь к устройству" занимает 16 байт, а остальные поля сдвинуты на 8 байт дальше<br />
	Путь на шине определяется по следующей логике:<br />
	<table width=100% border=1><tr><td class="auto-style1">Шина</td><td class="auto-style1">Смещение в таблице параметров диска</td><td class="auto-style1">Размер</td><td class="auto-style1">Смысл</td></tr><tr><td valign=top rowspan="3">
		ISA</td><td valign=top>
						   48</td><td>WORD</td><td>Адрес устройства.</td></tr><tr><td valign=top>
						   50</td><td>WORD</td><td>Резерв.</td></tr><tr><td valign=top>
						   52</td><td>DWORD</td><td>Резерв.<td></tr><tr><td valign=top rowspan="5">
		PCI, PCI-Express, HyperTransport, PCI-Express</td><td valign=top>
						   48</td><td>BYTE</td><td>Номер шины. Значение FFh означает, что это поле не используется.</td></tr><tr><td valign=top>
						   49</td><td>BYTE</td><td>Номер устройства. Значение FFh означает, что это поле не используется.</td></tr><tr><td valign=top>
						   50</td><td>BYTE</td><td>Номер функции. Значение FFh означает, что это поле не используется.</td></tr><tr><td valign=top>
						   51</td><td>BYTE</td><td>Номер канала. Значение FFh означает, что это поле не используется, кроме случая, когда устройство имеет интерфейс SATA (в этом случае данное поле всегда равно FFh).</td></tr><tr><td valign=top>
						   53</td><td>DWORD</td><td>Резерв.</td></tr><tr><td valign=top>
		InfiniBand</td><td valign=top>
						   48</td><td>QWORD</td><td>Резерв.</td></tr>
	</table><br /><br />
	Путь к устройству определяется по следующей логике:<br />
	<table width=100% border=1><tr><td class="auto-style1">Интерфейс</td><td class="auto-style1">Смещение в таблице параметров диска</td><td class="auto-style1">Размер</td><td class="auto-style1">Смысл</td></tr><tr><td valign=top rowspan="2">
		ATA</td><td valign=top>
						   56</td><td>BYTE</td><td>Номер устройства</td></tr><tr><td valign=top>
						   57</td><td>7*BYTE</td><td>Резерв</td></tr><tr><td valign=top rowspan="3">
		ATAPI</td><td valign=top>
						   56</td><td>BYTE</td><td>Номер устройства</td></tr><tr><td valign=top>
						   57</td><td>BYTE</td><td>Номер логического устройства</td></tr><tr><td valign=top>
						   58</td><td>6*BYTE</td><td>Резерв</td></tr><tr><td valign=top rowspan="2">
		SCSI</td><td valign=top>
						   56</td><td>BYTE</td><td>Номер устройства</td></tr><tr><td valign=top>
						   58</td><td>6*BYTE</td><td>Резерв</td></tr><tr><td valign=top rowspan="2">
		USB</td><td valign=top>
						   56</td><td>BYTE</td><td>Номер TBD</td></tr><tr><td valign=top>
						   57</td><td>7*BYTE</td><td>Резерв</td></tr><tr><td valign=top>
		1394</td><td valign=top>
						   56</td><td>QWORD</td><td>64-х битный GUID</td></tr><tr><td valign=top>
		FIBRE</td><td valign=top>
						   56</td><td>QWORD</td><td>64-х битный WWN</td></tr><tr><td valign=top>
		I2O</td><td valign=top>
						   56</td><td>QWORD</td><td>64-х битный тэг</td></tr><tr><td valign=top>
		RAID</td><td valign=top>
						   56</td><td>QWORD</td><td>Номер RAID-массива</td></tr><tr><td valign=top rowspan=3>
		SATA</td><td valign=top>
						   56</td><td>BYTE</td><td>Номер порта</td></tr><tr><td valign=top>
						   57</td><td>BYTE</td><td>Множитель порта</td></tr><tr><td valign=top>
						   58</td><td>6*BYTE</td><td>Резерв</td></tr><tr><td valign=top>
		SAS</td><td valign=top>
						   56</td><td>QWORD</td><td>64-х битный адрес</td></tr>
	</table>
	Как говорилось выше, предварительная редакция 4-ой версии стандарта EDD утверждает, что поле "путь к устройству" занимает 16 байт. В большинстве случаев дополнительные 8 байт зарезервированны, но есть неоторые исключения:<br />
	путь к SCSI устройству состоит из слова "номер SCSI ID" и четверного слова "номер логического устройства"<br />
	путь к FIBRE устройству в добавленой части содержит четверное слово "номер логического устройства"<br />
	путь к SAS устройству в добавленой части содержит четверное слово "номер логического устройства"<br /><br />
	Таблица конфигурации EDD выглядит следующим образом:<br />
	<table width=100% border=1><tr><td>Смещение</td><td>Размер</td><td>Смысл</td></tr><tr><td valign=top>
		0</td><td> WORD</td><td>Адрес порта ввода-вывода</td></tr><tr><td valign=top>
		2</td><td> WORD</td><td>Адрес управляющего порта</td></tr><tr><td valign=top>
		4</td><td> BYTE</td><td>
						&nbsp;&nbsp;биты 0-3 : резерв<br />
						&nbsp;&nbsp;бит 4 : 0 = Master, 1 = Slave<br />
						&nbsp;&nbsp;бит 5 : резерв установлен<br />
						&nbsp;&nbsp;бит 6 : используется LBA<br />
						&nbsp;&nbsp;бит 7 : резерв, установлен</td></tr><tr><td valign=top>
		5</td><td> BYTE</td><td> Зарезервированно для использования БИОСом</td></tr><tr><td valign=top>
		6</td><td> BYTE</td><td> Инофрмация о IRQ. Третья версия стандарта EDD отводит под номер IRQ только порые четыре бита, в предварительной же редакции 4-ой версии отводит под номер IRQ все 8 бит.</td></tr><tr><td valign=top>
		7</td><td> BYTE</td><td> Количество блоков для ATA комманд</td></tr><tr><td valign=top>
		8</td><td> BYTE</td><td>
						&nbsp;&nbsp;биты 0-3 : канал DMA<br />
						&nbsp;&nbsp;биты 4-7 : тип DMA, по спецификации ATA</td></tr><tr><td valign=top>
		9</td><td> BYTE</td><td>
						&nbsp;&nbsp;биты 0-3 : порт PIO<br />
						&nbsp;&nbsp;биты 4-7 : резерв</td></tr><tr><td valign=top>
		10</td><td> WORD</td><td> Конфигурация диска<br />
						&nbsp;&nbsp;бит 0 : включён режим PIO<br />
						&nbsp;&nbsp;бит 1 : включён режим DMA<br />
						&nbsp;&nbsp;бит 2 : ипользуются команды ATA READ MULTIPLE и WRITE MULTIPLE<br />
						&nbsp;&nbsp;бит 3 : используется CHS адресация<br />
						&nbsp;&nbsp;бит 4 : используется LBA адресация<br />
						&nbsp;&nbsp;бит 5 : устройство со съёмным носителем<br />
						&nbsp;&nbsp;бит 6 : устройство ATAPI<br />
						&nbsp;&nbsp;бит 7 : 32-х битный режим передачи<br />
						&nbsp;&nbsp;бит 8 : ATAPI устройство использует прерывание для информирования о готовности<br />
						&nbsp;&nbsp;биты 9-10 : тип трансляции<br />
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00 - Трансляция с битовым смещением<br />
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 - Трансляция LBA<br />
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 - резерв<br />
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11 - определяется производителем<br />
						&nbsp;&nbsp;бит 11 : используется доступ с помощью UltraDMA<br />
						&nbsp;&nbsp;бит 12 : HPA активна<br />
						&nbsp;&nbsp;бит 13 : используется LBA48 адресация<br />
						&nbsp;&nbsp;биты 14-15 : резерв</td></tr><tr><td valign=top>
		12</td><td> WORD</td><td> Резерв</td></tr><tr><td valign=top>
		14</td><td> BYTE</td><td> Версия таблицы. 10h : 1.0 , 11h : 1.1 - 3.0 , 30h : 4.0</td></tr><tr><td valign=top>
		15</td><td> BYTE</td><td> Контрольная сумма</td></tr>
	</table></td></tr><tr><td valign=top>
49h</td><td>Получить расширенный статус смены носителя<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br /><br />
	<b>Выход:</b><br />
	Флаг переноса сброшен, AH==0 : носителт не менялся<br />
	Флаг переноса установлена, AH==6 : носитель сменился, если AH имеет иноезначение - то это код ошибки.<br /><br />
	<b>Примечание:</b><br />
	Если в DL передать номер диска с несъёмным носителем, то функция вернёт, что смены диска не было.</td></tr><tr><td valign=top>
4Eh</td><td>Установить конфигурацию оборудования<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	AL - функция:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;0 : разрешить предвыборку<br />
	&nbsp;&nbsp;&nbsp;&nbsp;1 : запретить предвыборку<br />
	&nbsp;&nbsp;&nbsp;&nbsp;2 : установить максимальный номер режима PIO и установить максимально возможную скорость передачи данных<br />
	&nbsp;&nbsp;&nbsp;&nbsp;3 : установить минимальный номер режима PIO и установить минимальную скорость передачи данных<br />
	&nbsp;&nbsp;&nbsp;&nbsp;4 : устновить скорость передачи данных и номер режима PIO на стандартные значения<br />
	&nbsp;&nbsp;&nbsp;&nbsp;5 : включить передачу данных в режиме DMA. Установить максимально возможную скорость<br />
	&nbsp;&nbsp;&nbsp;&nbsp;6 : отключить режим DMA<br /><br />
	<b>Выход:</b><br />
	Флаг переноса сброшен, AH==0 : функция выполнена успешно ; AH==1 : функция выполнена успешно, но повлияла на другие устройства<br />
	Флаг переноса установлен : произошла ошибка, AH - <a href="#codesEDD">состояние дисковой подсистемы</a></td></tr><tr><td valign=top>
50h</td><td>Послать коммандный пакет<br /><br />
	<b>Вход:</b><br />
	DL - номер диска(80h ... 0FFh)<br />
	AL = 01
	ES:BX - указатель на коммандный пакет
	<table border=1 width=100%><tr><td>Смещение</td><td>Размер</td><td>Смысл</td></tr></tr><td>
		0</td><td> WORD</td><td>0B055h</td></tr><tr><td>
		2</td><td> BYTE</td><td>Размер пакета</td></tr><tr><td>
		3</td><td> BYTE</td><td>Резерв</td></tr><tr><td>
		4</td><td> определяется программистом</td><td>Тело пакета</td></tr>
	</table><br />
	<b>Выход:</b><br />
	AH - <a href="#codesEDD">состояние дисковой подсистемы</a><br />
	Если флаг переноса установлен - произошла ошибка</td></tr>
</table>
<br />
<a name="codesEDD">Коды состояния дисковой подсистемы(коды ошибок)</a>
Расширенный дисковый API использует те же коды ошибок, что и класический, а так же определяет несколько новых<br />
<table border=1 width=100%>
<tr><td>Код</td><td>Значение</td></tr><tr><td valign=top>
B0</td><td>Диск не заблокирован</td></tr><tr><td valign=top>
B1</td><td>Диск заблокирован</td></tr><tr><td valign=top>
B2</td><td>Диск не имеет съёмного носителя</td></tr><tr><td valign=top>
B3</td><td>Диск занят (используется)</td></tr><tr><td valign=top>
B4</td><td>Превышено количество блокировок</td></tr><tr><td valign=top>
B5</td><td>Пропытка извлечения носителя провалилась</td></tr><tr><td valign=top>
B6</td><td>Диск защищён от чтения</td></tr>
</table>
<br />
<br />
	<a name="CD"><h3>Сервис загружаемых CD</h3></a>
<table border=1 width=100%><tr><td valign=top>AH</td><td> функция </td></tr><tr><td valign=top>
4Ah</td><td>Запустить эмуляцию.<br /><br />
	<b>Вход:</b><br />
	AL = 0<br />
	DI:SI - спецификационный пакет<br /><br />
	<b>Выход:</b><br />
	AX - состояние дисковой подсистемы (то же значение, что и для расширенного API)<br />
	Если флаг CF установлен, то произошла ошибка.<br /><br />
	<b>Примечание:</b><br />
	Спецификационный пакет имеет следующий формат:
	<table border=1 width=100%><tr><td>Смещение</td><td>Размер</td><td>Смысл</td></tr></tr><td>
		0</td><td> BYTE</td><td>Размер пакета (13h)</td></tr><tr><td valign=top>
		1</td><td> BYTE</td><td>Тип устройтсва:<br />
								биты 0-3: тип эмулируемого устройства:<br />
								&nbsp;&nbsp;&nbsp;&nbsp;нет эмуляции<br />
								&nbsp;&nbsp;&nbsp;&nbsp;дискета 1.2 мб<br />
								&nbsp;&nbsp;&nbsp;&nbsp;дискета 1.44 мб<br />
								&nbsp;&nbsp;&nbsp;&nbsp;жёсткий диск<br />
								биты 4 и 5: резерв<br />
								бит 6: устройство ATAPI<br />
								бит 7: устройство SCSI</td></tr><tr><td valign=top>
		2</td><td> BYTE</td><td>Номер диска</td></tr><tr><td valign=top>
		3</td><td> BYTE</td><td>Номер контроллера</td></tr><tr><td valign=top>
		4</td><td> DWORD</td><td>Адрес LBA</td></tr><tr><td valign=top>
		8</td><td> WORD</td><td>Положение устройства на шине.<br />
								Для ATAPI устройств:<br />
								&nbsp;&nbsp;&nbsp;&nbsp;бит 0: 0==Master, 1==Slave<br />
								&nbsp;&nbsp;&nbsp;&nbsp;биты 1-15: резерв<br />
								Для SCSI устройств:<br />
								&nbsp;&nbsp;&nbsp;&nbsp;биты 0-7: LUN(номер логического устройства) и PUN(номер физического устройства)<br />
								&nbsp;&nbsp;&nbsp;&nbsp;биты 8-16: номер шины.</td></tr><tr><td valign=top>
		10</td><td> WORD</td><td>Сегмент для буфера.<br />
								Обратите внимание, что смещение для буфера считается равным нулю. Кроме того, размер буфера должен бфть 3 Кб</td></tr><tr><td valign=top>
		12</td><td> WORD</td><td>Сегмент для загрузки (если установлен в ноль, то считается равным 7С0h)</td></tr><tr><td valign=top>
		14</td><td> WORD</td><td>Размер эмулируемого сектора в блоках по 512 байт.</td></tr><tr><td valign=top>
		16</td><td> 3*BYTE</td><td>параметры CHS:
								биты 0-7: младшая часть количества дорожек
								биты 8-13: количество секторов
								биты 14-15: старшая часть количества дорожек
								биты 16-24: количество головок</td></tr>
	</table></td></tr><tr><td valign=top>
4Bh</td><td>
	<table border=1 width=100%><tr><td>AL</td><td>Значение</td></tr><tr><td valign=top>
	00</td><td>Отключить эмуляцию и получить статус<br/><br/>
		<b>Вход:</b><br />
		DL - номер дискогого устройства (если переданно значение 7Fh, то будут завершенны все действующие эмуляции)<br />
		DS:SI - адрес, куда будет сохранён спецификационный пакет<br /><br />
		<b>Выход:</b><br />
		DS:SI - заполненный спецификационный пакет<br />
		AX - состояние дисковой подсистемы (то же значение, что и для расширенного API)<br />
		Если флаг CF установлен, то произошла ошибка.</td></tr><tr><td valign=top>
	01</td><td>Получить статус<br/><br/>
		<b>Вход:</b><br />
		DL - номер дискогого устройства<br />
		DS:SI - адрес, куда будет сохранён спецификационный пакет<br /><br />
		<b>Выход:</b><br />
		DS:SI - заполненный спецификационный пакет<br />
		AX - состояние дисковой подсистемы (то же значение, что и для расширенного API)<br />
		Если флаг CF установлен, то произошла ошибка.</td></tr>
	</table></td></tr><tr><td valign=top>
4Ch</td><td>Запустить эмуляцию и загрузится с диска.<br /><br />
	<b>Вход:</b><br />
	AL = 0<br />
	DI:SI - спецификационный пакет</td></tr><tr><td valign=top>
4Dh</td><td>Узнать загрузочный каталог.<br /><br />
	<b>Вход:</b><br />
	AL = 0<br />
	DI:SI - пакет команды<br /><br />
	<b>Примечание:</b><br />
	Пакет крманды имеет следующий формат:
	<table border=1 width=100%><tr><td>Смещение</td><td>Размер</td><td>Смысл</td></tr></tr><td valign=top>
		0</td><td>BYTE</td><td>размер пакета (= 08)</td></tr><tr><td valign=top>
		1</td><td>BYTE</td><td>количесвто передаваемых секторов</td></tr><tr><td valign=top>
		2</td><td>DWORD</td><td>адрес в памяти, куда будут записанны сектора</td></tr><tr><td valign=top>
		6</td><td>WORD</td><td>с какого сектора начинать чтение (относительно первого сектора корневого каталога)</td></tr>
	</table>
</td></tr>
</table>
<br />	
</body>
</html>
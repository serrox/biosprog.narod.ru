<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Низкоуровневое програмирование</title>
	<meta name="keywords" content="программирование BIOS INT INT13 реальный режим ассемблер 16bit дисковый сервис" />
	<meta name="description" content="Низкоуровневое программирование: Прерывания БИОС: INT 13" />
</head>
<body>
	<a href=../../index.htm>Главная</a> - <a href=../index.htm> Реальный режим </a> - <a href=int.htm>Прерывания Bios</a> - <b>INT 13h: Дисковый ввод-вывод .</b><br />
	<h2>INT 13h: Дисковый ввод-вывод .</h2>
<table border=1 width=100%><tr><td valign=top>AH</td><td> функция </td></tr><tr><td valign=top>
0</td><td>Сброс устройства. вызывает рекалибрацию контроллера. Если DL равен 80H или 81H, выполнен сброс контроллера жесткого диска, иначе FDD.</td></tr><tr><td valign=top>
1</td><td>дать статус ошибки последней операции.<br /><br />
    вход: DL = диск.  DL ( 80h = дискета; 7Fh = твердый диск)<br />
   выход: AL содержит <a href=#code>код ошибки диска</a><br /></td></tr><tr><td valign=top>
<a name=2>2</a></td><td> читать секторы<br /><br />
     вход: DL = номер диска (0=диск A...; 80h=HDD 0; 81h=HDD 1...) (обычно при запуске системы номер диска, с которого проведён запуск  передаётся в dl, но НЕ при запуске программы в DOS)<br />
           DH = номер головки чтения/записи<br />
           CH = биты 0-7 номера дорожки (цилиндра)<br />
           CL =<br />
		   биты 0-5 - номер сектора (Считая с 1)<br />
		   биты 6-7 - биты 8-9 номера дорожки<br />
           AL = число секторов (в сумме не больше чем один цилиндр)<br />
           ES:BX => адрес буфера вызывающей программы<br />
           0:0078 => таблица параметров дискеты (для гибких дисков) (обычно предустановлена)<br />
           0:0104 => таблица параметров тв.диска (для твердых дисков) (обычно предустановлена)<br />
   выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
          ES:BX буфер содержит данные, прочитанные с диска.<br /></td></tr><tr><td valign=top>
3</td><td>писать секторы<br /><br />
     вход: (аналогично подфункции <a href=int13.htm#2>02H</a>)<br />
           ES:BX => данные, записываемые на диск.<br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.</td></tr><tr><td valign=top>
4</td><td>проверить секторы. проверяет CRC для указанных секторов на ошибки.<br /><br />
     вход: (аналогично подф. 02h. ES:BX лучше также предоставить)<br/>
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.</td></tr><tr><td valign=top>
5</td><td>форматировать дорожку. данные на дорожке, если есть, разрушаются.<br /><br />
     вход: DL,DH,CH = диск,головка,дорожка (см. фуекцию <a href=int13.htm#2>02H</a>)<br />
           ES:BX => дескрипторы секторов (требуется 512-байтовый буфер)<br/>
              дискета: 1 4-байтовый 'CHNS' (цилиндр,Головка,Nсектора,размер) для каждого сектора на дорожке (т.е. 36 байт для 9-секторных дорожек); номера секторов д.б. упорядочены. 'Z' - код размера сектора:  0=128; 1=256; 2=512; 3=1024<br />
       <font color=red>для AT</font> Тв. диск: 1 2-байтовый 'FN' (флаг,Nсектора) для каждого сектора на дорожке. последовательность полей 'N' определяет "коэффициент прослаивания" ("interleave factor").<br />
       <font color=red>для XT</font> Тв. диск: ES:BX не используется. Вместо этого AL содержит значениеv"прослаивания" между 1 и 16 (10h).<br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
           (тв. диск: 'F'-поля установлены в 80H, чтобы пометить плохие секторы)</td></tr><tr><td valign=top>
8</td><td>Параметры диска<br />
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br /><br />
     вход: DL = диск<br />
    выход: DL = число тв. дисков на первом контроллере<br />
           DH = максимальный номер головки<br />
           CH = максимальный номер цилиндра (младшие 8 бит)<br />
           CL =<br />
			биты 0-5 - максимальный номер сектора (и старшие биты максимум номера цилиндра)<br />
			биты 6-7  - биты 8-9 максимаьного номера цилиндра</td></tr><tr><td valign=top>
9</td><td>Инициализировать параметры диска<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
Сообщает BIOS о любом динамическом изменении таблиц параметров устройства.<br />
     вход:<br />
	 DL - номер диска<br />
	 векторы для INT 41h и INT 46h адресуют Табл. параметров тв. диска соответственно для устройств 0 и 1.<br />
    замечание: в XT совместимом компьютере обе таблицы указываются через вектор INT 40h.</td></tr><tr><td valign=top>
0Ah</td><td>Длинное чтение<br />
512 байт + 4-байтоый ECC (код коррекции ошибок).<br />
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br /><br />
     вход: см. <a href=#2>функцию 2</a><br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
           ES:BX => в буфере (данные сектора + 4 байта) * число секторов</td></tr><tr><td valign=top>
0Bh</td><td>Длинная запись<br />
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
Пишет 512 байт + 4-байтовый ECC.<br /><br />
     вход: см. <a href=#2>функцию 2</a><br />
           ES:BX => буфер содержит данные сектора + 4 байта на каждый сектор<br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.</td></tr><tr><td valign=top>
0Ch</td><td>Искать цилиндрБ=<br />
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
Перемещает головку к нужной дорожке<br /><br />
     вход: DL - номер диска<br />
DH - Номер Головки<br />
CH - Номер дорожки<br />
CL - (предположительно биты 6-7) старшие биты номера дорожки<br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.</td></tr><tr><td valign=top>
0Dh</td><td>Сброс устройства<br/>
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
Вход: DL - диск</td></tr><tr><td valign=top>
0Eh</td><td>Читать буфер секторов<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: как для <a href=int13.htm#2>функции 02H</a><br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
По адресу ES:BX содержание буфера</td></tr><tr><td valign=top>
0Fh</td><td>Писать буфер секторов<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: как для <a href=int13.htm#2>функции 02h</a><br />
    выход: Carry-флаг=1 при ошибке и <a href=#code>код ошибки диска</a> в AH.<br />
По адресу ES:BX содержание буфера</td></tr><tr><td valign=top>
10h</td><td>проверить готовность устройства<br/>
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
     вход: DL = диск<br/>
    выход: <a href=#code>код ошибки диска</a> (статус) в AH.(обычно при запуске системы номер диска, с которого проведён запуск  передаётся в DL, но НЕ при запуске программы в DOS)</td></tr><tr><td valign=top>
11h</td><td> Рекалибровать устройство<br/>
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
     вход: DL = диск(обычно при запуске системы номер диска, с которого проведён запуск  передаётся в DL, но НЕ при запуске программы в DOS)<br/>
    выход: <a href=#code>код ошибки диска</a> (статус) в AH.</td></tr><tr><td valign=top>
12h</td><td> Диагностика RAM контроллера<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: DL = диск<br/>
    выход: <a href=#code>код ошибки диска</a> (статус) в AH.</td></tr><tr><td valign=top>
13h</td><td> Диагностика устройства<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: DL = диск<br/>
    выход: <a href=#code>код ошибки диска</a> (статус) в AH.</td></tr><tr><td valign=top>
14h</td><td> Внутренняя диагностика контроллера<br/>
<font color=red><b>Только AT и XT совместимые компьютеры</b></font><br />
     вход: DL = диск<br/>
    выход: <a href=#code>код ошибки диска</a> (статус) в AH.</td></tr><tr><td valign=top>
15h</td><td> читать тип диска (недоступна в XT BIOS)<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: DL = диск<br />
    выход: AH = код устройства:<br />
                бит 0 = устройство DL отсутствует<br />
                бит 1 = дискета; логика замены диска отсутствует<br />
                бит 2 = дискета; логика замены диска доступна (большинство случаев)<br />
                бит 3 = твердый диск</td></tr><tr><td valign=top>
16h</td><td> читать статус замены диска<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: DL = диск (0 или 1)<br />
    выход: AH = код статуса:<br />
                0 = диск не был заменен<br />
                1 = неверный номер диска;<br />
                6 = замена активна (открыта дисковая дверь);<br />
                80 = ошибка таймаута;<br />
                DL = номер заменяемого диска</td></tr><tr><td valign=top>
17h</td><td> установить тип дискеты (используется перед операцией форматирования)<br />
<font color=red><b>Только AT совместимые компьютеры</b></font><br /><br />
     вход: DL = номер устройства диска (0 или 1)<br />
           AL = тип носителя диска:<br />
                0 = не используется<br />
                1 = 360K дискета в 360K устройстве<br />
                2 = 360K дискета в 1.2M устройстве<br />
                3 = 1.2M дискета в 1.2M устройстве<br />
                4 = 720K дискета в 720K или (поддерживается не всеми биосами) 1.44M устройстве</td></tr><tr><td valign=top>
18h</td><td> установить тип диска (используется перед операцией форматирования)<br />
<font color=red><b>Только AT и/или XT совместимые компьютеры</b></font><br /><br />
     вход: DL = номер устройства диска <br />
	CH = Максимальный номер цилиндра<br />
	CL :<br />
	биты 0-5 кол-во секторов на дорожке<br />
	биты 6,7 старшие биты номера цилиндра</td></tr><tr><td valign=top>
19h</td><td> Припарковать головки<br />
<font color=red><b>Только XT286 совместимые компьютеры</b></font><br /><br />
     вход: DL = номер устройства диска </td></tr><tr><td valign=top>
1Ah</td><td>Форматирование жесткого диска с контроллером типа ESDI<br />
AL — количество элементов в таблице дефектов; <br />
DL — номер диска; <br />
CL :<br />
бит 0: ==1 игнорировать первичную таблицу дефектов<br />
бит 1: ==1 игнорировать вторичную таблицу дефектов<br />
бит 2: ==1 обновить вторичную таблицу дефектов<br />
бит 3: ==1 выполнить анализ поверхности<br />
бит 4: ==1 генерировать прерывание INT15h в конце каждой дорожки<br />
бит 5-7: =0<br />
ES:BX — адрес таблицы дефектов.<br />
Выход: CF, АН — признак и код ошибки.<br />
</td></tr><tr><td valign=top>
20h</td><td>Получить тип дискеты<br />
     вход: DL = номер устройства диска (0 или 1)<br />
	 Выход:<br />
	 AL - тип:<br />
	 00 - 720 кб<br />
	 01 - 1.44 мб<br />
	 02 - 2.88 мб<br />
	 03 - 1 мб<br />
	 04 - 2 мб<br />
	 06 - 4 мб<br />
</td></tr>
</table>
<br />
<a name=code>Коды ошибок INT13h</a><br />
<table border=1 width=100%>
<tr><td>Код</td><td>Значение</td></tr><tr><td valign=top>
00</td><td>Нет ошибки</td></tr><tr><td valign=top>
01</td><td>Ошибка комманды</td></tr><tr><td valign=top>
02</td><td>Не найдена адресная метка</td></tr><tr><td valign=top>
03</td><td>Диск защищён от записи</td></tr><tr><td valign=top>
04</td><td>Не найден сектор</td></tr><tr><td valign=top>
05</td><td>Ошибка при сбросе HDD</td></tr><tr><td valign=top>
06</td><td>Произошла замена дискеты</td></tr><tr><td valign=top>
07</td><td>Неправильные параметры HDD</td></tr><tr><td valign=top>
08</td><td>Переполнение канала DMA</td></tr><tr><td valign=top>
09</td><td>Выход за приделы 64КБ при работе с DMA</td></tr><tr><td valign=top>
0Ah</td><td>Плохой сектор</td></tr><tr><td valign=top>
0Bh</td><td>Плохая дорожка</td></tr><tr><td valign=top>
0Ch</td><td>Неправильный номер дорожки)</td></tr><tr><td valign=top>
0Dh</td><td>Неправильный номер сектора</td></tr><tr><td valign=top>
0Eh</td><td>Обнаружена адресная метка управляющих данных</td></tr><tr><td valign=top>
0Fh</td><td>Ошибка DMA</td></tr><tr><td valign=top>
10h</td><td>Ошибка данных</td></tr><tr><td valign=top>
11h</td><td>Была произведена коррекция данных</td></tr><tr><td valign=top>
20h</td><td>Сбой контроллера</td></tr><tr><td valign=top>
30h</td><td>Неподдерживаемый формат дискеты</td></tr><tr><td valign=top>
31h</td><td>Дискета извлечена</td></tr><tr><td valign=top>
32h</td><td>Неподдерживаемый тип дискеты</td></tr><tr><td valign=top>
40h</td><td>Сбой при поиске дорожки</td></tr><tr><td valign=top>
80h</td><td>Ошибка таймаута</td></tr><tr><td valign=top>
AAh</td><td>Диск не готов</td></tr><tr><td valign=top>
BBh</td><td>Неизвестная ошибка</td></tr><tr><td valign=top>
CCh</td><td>Сбой при записи</td></tr><tr><td valign=top>
E0h</td><td>Ошибка регистра состояния</td></tr><tr><td valign=top>
FFh</td><td>Ошибка при чтении</td></tr>
</table>
</body>
</html>